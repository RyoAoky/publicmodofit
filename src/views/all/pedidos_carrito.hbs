<section class="py-5">
    <div class="container">
        <h2 class="fw-bold mb-4"><i class="bi bi-cart3 me-2"></i>Mi Carrito</h2>

        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div id="carrito-items">
                            <!-- Items del carrito se cargan con JS -->
                        </div>
                        <div id="carrito-vacio" class="text-center py-5" style="display: none;">
                            <i class="bi bi-cart-x fs-1 text-muted"></i>
                            <p class="mt-3 text-muted">Tu carrito está vacío</p>
                            <a href="/pedidos" class="btn btn-primary">
                                <i class="bi bi-shop me-2"></i>Ir a la tienda
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent border-0 py-3">
                        <h5 class="mb-0 fw-bold">Resumen del Pedido</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal</span>
                            <span id="subtotal">S/ 0.00</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>IGV (18%)</span>
                            <span id="igv">S/ 0.00</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between fw-bold">
                            <span>Total</span>
                            <span id="total" class="text-primary fs-4">S/ 0.00</span>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0 p-3">
                        <a href="/pedidos/checkout" class="btn btn-primary w-100 btn-lg" id="btn-checkout">
                            <i class="bi bi-credit-card me-2"></i>Proceder al Pago
                        </a>
                        <a href="/pedidos" class="btn btn-outline-secondary w-100 mt-2">
                            <i class="bi bi-arrow-left me-2"></i>Seguir Comprando
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
let carrito = JSON.parse(localStorage.getItem('modofit_carrito')) || [];

function renderCarrito() {
    const container = document.getElementById('carrito-items');
    const vacioMsg = document.getElementById('carrito-vacio');
    const btnCheckout = document.getElementById('btn-checkout');
    
    if (carrito.length === 0) {
        container.style.display = 'none';
        vacioMsg.style.display = 'block';
        btnCheckout.classList.add('disabled');
        return;
    }
    
    container.style.display = 'block';
    vacioMsg.style.display = 'none';
    btnCheckout.classList.remove('disabled');
    
    let html = '<table class="table table-hover mb-0"><thead class="table-light"><tr><th>Producto</th><th class="text-center">Cantidad</th><th class="text-end">Precio</th><th class="text-end">Subtotal</th><th></th></tr></thead><tbody>';
    
    carrito.forEach((item, index) => {
        html += `
            <tr>
                <td>
                    <strong>${item.nombre}</strong>
                    <br><small class="text-muted">${item.tipo === 'membresia' ? 'Membresía' : 'Producto'}</small>
                </td>
                <td class="text-center">
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary" onclick="cambiarCantidad(${index}, -1)">-</button>
                        <span class="btn btn-outline-secondary disabled">${item.cantidad}</span>
                        <button class="btn btn-outline-secondary" onclick="cambiarCantidad(${index}, 1)">+</button>
                    </div>
                </td>
                <td class="text-end">S/ ${item.precio.toFixed(2)}</td>
                <td class="text-end fw-bold">S/ ${(item.precio * item.cantidad).toFixed(2)}</td>
                <td class="text-end">
                    <button class="btn btn-sm btn-outline-danger" onclick="eliminarItem(${index})">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
    
    actualizarTotales();
}

function cambiarCantidad(index, delta) {
    carrito[index].cantidad += delta;
    if (carrito[index].cantidad <= 0) {
        carrito.splice(index, 1);
    }
    guardarYRender();
}

function eliminarItem(index) {
    carrito.splice(index, 1);
    guardarYRender();
}

function guardarYRender() {
    localStorage.setItem('modofit_carrito', JSON.stringify(carrito));
    renderCarrito();
}

function actualizarTotales() {
    const subtotal = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
    const igv = subtotal * 0.18;
    const total = subtotal;
    
    document.getElementById('subtotal').textContent = 'S/ ' + (subtotal - igv).toFixed(2);
    document.getElementById('igv').textContent = 'S/ ' + igv.toFixed(2);
    document.getElementById('total').textContent = 'S/ ' + total.toFixed(2);
}

document.addEventListener('DOMContentLoaded', renderCarrito);
</script>
